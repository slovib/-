{% load static %}
<h2>–ó–∞–¥–∞—á–∞: {{ task.title }}</h2>
<p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ task.description|linebreaks }}</p>
<p><strong>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</strong> {{ task.get_priority_display }}</p>
<p><strong>–î–µ–¥–ª–∞–π–Ω:</strong> {{ task.due_date|date:"d.m.Y H:i" }}</p>
<p><strong>–ù–∞–∑–Ω–∞—á–µ–Ω–æ:</strong> {{ task.assigned_to.username|default:"–Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ" }}</p>

<hr>

<h3>üîπ –ü–æ–¥–∑–∞–¥–∞—á–∏</h3>
<ul>
  {% for sub in subtasks %}
    <li
      style="
        {% if sub.is_completed %}
          text-decoration: line-through;
        {% elif sub.due_date and sub.due_date < now %}
          color: red;
        {% endif %}
        margin-bottom: 8px;
      "
    >
      <strong>{{ sub.title }}</strong> ‚Äî {{ sub.assigned_to.username|default:"–Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ" }}

      {% if sub.is_completed %}
        ‚úÖ
      {% else %}
        ‚ùå
      {% endif %}

      {% if sub.due_date %}
        <br>
        <strong>–î–µ–¥–ª–∞–π–Ω:</strong>
        <span
          style="{% if not sub.is_completed and sub.due_date < now %}background-color: #ffcccc; padding: 2px 4px; border-radius: 4px;{% endif %}"
        >
          {{ sub.due_date|date:"d.m.Y H:i" }}
        </span>
      {% endif %}

      <form method="post" action="{% url 'tasks:toggle_subtask' sub.id %}" style="display:inline;">
        {% csrf_token %}
        <button type="submit">
          {% if sub.is_completed %}–í–µ—Ä–Ω—É—Ç—å –≤ —Ä–∞–±–æ—Ç—É{% else %}–í—ã–ø–æ–ª–Ω–µ–Ω–æ{% endif %}
        </button>
      </form>

      <a href="{% url 'tasks:edit_subtask' sub.id %}" style="margin-left: 10px;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
      <a href="{% url 'tasks:delete_subtask' sub.id %}" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–¥–∑–∞–¥–∞—á—É?');" style="color:red; margin-left: 10px;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
    </li>
  {% empty %}
    <li>–ü–æ–¥–∑–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç.</li>
  {% endfor %}
</ul>

<h4>‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∑–∞–¥–∞—á—É</h4>
<form method="post">
  {% csrf_token %}
  {{ subtask_form.as_p }}
  <button type="submit" name="add_subtask">–î–æ–±–∞–≤–∏—Ç—å</button>
</form>

<hr>

<h3>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
{% for comment in comments %}
  <div style="border: 1px solid #ccc; padding: 8px; margin-bottom: 10px;">
    <strong>{{ comment.author.username }}</strong> ‚Äî {{ comment.created_at|date:"d.m.Y H:i" }}<br>
    <p>{{ comment.text|linebreaks }}</p>
    {% if comment.file %}
      <a href="{{ comment.file.url }}" target="_blank">üìé –í–ª–æ–∂–µ–Ω–∏–µ</a>
    {% endif %}
  </div>
{% empty %}
  <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
{% endfor %}

<h4>‚úçÔ∏è –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h4>
<form method="post" enctype="multipart/form-data">
  {% csrf_token %}
  {{ form.as_p }}
  <button type="submit" name="add_comment">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</form>

<hr>

<h3>üìú –ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
<ul class="activity-log">
  {% for activity in activities %}
    <li>
      <strong>{{ activity.user.username }}</strong>
      {% if activity.action == 'created' %}
        —Å–æ–∑–¥–∞–ª(–∞) –∑–∞–¥–∞—á—É
      {% elif activity.action == 'edited' %}
        –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª(–∞) –∑–∞–¥–∞—á—É
      {% elif activity.action == 'completed' %}
        –≤—ã–ø–æ–ª–Ω–∏–ª(–∞) –∑–∞–¥–∞—á—É
      {% elif activity.action == 'reopened' %}
        –≤–æ–∑–æ–±–Ω–æ–≤–∏–ª(–∞) –∑–∞–¥–∞—á—É
      {% elif activity.action == 'commented' %}
        –æ—Å—Ç–∞–≤–∏–ª(–∞) –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
      {% elif activity.action == 'added_subtask' %}
        –¥–æ–±–∞–≤–∏–ª(–∞) –ø–æ–¥–∑–∞–¥–∞—á—É: <em>"{{ activity.subtask.title }}"</em>
      {% elif activity.action == 'edited_subtask' %}
        –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª(–∞) –ø–æ–¥–∑–∞–¥–∞—á—É: <em>"{{ activity.subtask.title }}"</em>
      {% elif activity.action == 'deleted_subtask' %}
        —É–¥–∞–ª–∏–ª(–∞) –ø–æ–¥–∑–∞–¥–∞—á—É
      {% elif activity.action == 'completed_subtask' %}
        –≤—ã–ø–æ–ª–Ω–∏–ª(–∞) –ø–æ–¥–∑–∞–¥–∞—á—É: <em>"{{ activity.subtask.title }}"</em>
      {% elif activity.action == 'reopened_subtask' %}
        –≤–æ–∑–æ–±–Ω–æ–≤–∏–ª(–∞) –ø–æ–¥–∑–∞–¥–∞—á—É: <em>"{{ activity.subtask.title }}"</em>
      {% elif activity.action == 'deleted' %}
        —É–¥–∞–ª–∏–ª(–∞) –∑–∞–¥–∞—á—É
      {% endif %}
      <small class="text-muted"> ‚Äî {{ activity.timestamp|date:"d.m.Y H:i" }}</small>
    </li>
  {% endfor %}
</ul>
<form method="post" action="{% url 'tasks:clear_activity' task.id %}" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é?');">
  {% csrf_token %}
  <button type="submit" style="color: red;">üßπ –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
</form>


<p><a href="{% url 'tasks:team_detail' team.id %}">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–æ–º–∞–Ω–¥–µ</a></p>
